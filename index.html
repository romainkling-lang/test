<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<title>Vérin Hydraulique 3D Interactif</title>

<style>
body {
  margin: 0;
  background: #1a1a1a;
  color: white;
  font-family: Segoe UI, Tahoma, sans-serif;
  overflow: hidden;
}
canvas { display: block; }

#controls {
  position: absolute;
  top: 10px;
  left: 10px;
  background: rgba(0,0,0,0.75);
  padding: 15px 20px;
  border-radius: 8px;
  font-size: 14px;
  max-width: 300px;
}
label {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-top: 10px;
}
input[type=range] {
  flex: 1;
  margin: 0 10px;
}
.valeur {
  min-width: 40px;
  color: #00ffff;
  font-weight: bold;
}
#volumes {
  margin-top: 12px;
  color: #a0d0ff;
  font-weight: bold;
}
</style>
</head>

<body>

<div id="controls">
  <label>Course
    <input type="range" id="sliderCourse" min="0" max="100" value="50">
    <span class="valeur" id="valCourse"></span>
  </label>
  <label>Rotation
    <input type="range" id="sliderRot" min="0" max="360" value="0">
    <span class="valeur" id="valRot"></span>
  </label>
  <label>Ø Piston
    <input type="range" id="sliderPiston" min="2" max="6" step="0.1" value="4">
    <span class="valeur" id="valPiston"></span>
  </label>
  <label>Ø Tige
    <input type="range" id="sliderTige" min="0.5" max="5" step="0.1" value="1.5">
    <span class="valeur" id="valTige"></span>
  </label>

  <div id="volumes">
    Chambre fond : <span id="volFond"></span> cm³<br>
    Chambre tige : <span id="volTigeVol"></span> cm³
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.148.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.148.0/examples/js/renderers/CSS2DRenderer.js"></script>

<script>
/* ================== SCENE ================== */
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(60, innerWidth/innerHeight, 0.1, 1000);
camera.position.set(0, 10, 25);

const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth, innerHeight);
document.body.appendChild(renderer.domElement);

const labelRenderer = new THREE.CSS2DRenderer();
labelRenderer.setSize(innerWidth, innerHeight);
labelRenderer.domElement.style.position = "absolute";
labelRenderer.domElement.style.top = 0;
labelRenderer.domElement.style.pointerEvents = "none";
document.body.appendChild(labelRenderer.domElement);

/* ================== LIGHT ================== */
scene.add(new THREE.AmbientLight(0x404040));
const light = new THREE.DirectionalLight(0xffffff, 1);
light.position.set(10,10,10);
scene.add(light);

/* ================== PARAMS ================== */
let diameterPiston = 4;
let diameterTige = 1.5;
const maxCourse = 10;
const volumeMort = 1;

/* ================== VERIN ================== */
const groupVerin = new THREE.Group();
scene.add(groupVerin);

let cylFond, cylTige, piston, rod;

function createVerin() {
  const rP = diameterPiston / 2;
  const rT = diameterTige / 2;

  cylFond = new THREE.Mesh(
    new THREE.CylinderGeometry(rP, rP, maxCourse, 64),
    new THREE.MeshStandardMaterial({color:0x0077ff, transparent:true, opacity:0.3})
  );
  cylFond.rotation.z = Math.PI/2;
  groupVerin.add(cylFond);

  cylTige = new THREE.Mesh(
    new THREE.CylinderGeometry(rP, rP, maxCourse, 64),
    new THREE.MeshStandardMaterial({color:0x00ff88, transparent:true, opacity:0.3})
  );
  cylTige.rotation.z = Math.PI/2;
  groupVerin.add(cylTige);

  piston = new THREE.Mesh(
    new THREE.CylinderGeometry(rP, rP, 1, 64),
    new THREE.MeshStandardMaterial({color:0xff3333})
  );
  piston.rotation.z = Math.PI/2;
  groupVerin.add(piston);

  rod = new THREE.Mesh(
    new THREE.CylinderGeometry(rT, rT, 14, 64),
    new THREE.MeshStandardMaterial({color:0xaaaaaa, metalness:0.8, roughness:0.2})
  );
  rod.rotation.z = Math.PI/2;
  groupVerin.add(rod);
}

function rebuildVerin() {
  groupVerin.clear();
  createVerin();
  updateVerin();
}

/* ================== UPDATE ================== */
function updateVerin() {
  diameterTige = Math.min(diameterTige, diameterPiston * 0.9);
  sliderTige.value = diameterTige.toFixed(1);

  const course = (sliderCourse.value / 100) * maxCourse;
  const pistonX = course - maxCourse/2;

  piston.position.x = pistonX;
  rod.position.x = pistonX + 6;

  cylFond.scale.x = course / maxCourse;
  cylFond.position.x = - (maxCourse - course)/2;

  cylTige.scale.x = (maxCourse - course) / maxCourse;
  cylTige.position.x = course/2;

  groupVerin.rotation.y = THREE.MathUtils.degToRad(sliderRot.value);

  const rP = diameterPiston/2;
  const rT = diameterTige/2;

  volFond.textContent =
    (volumeMort + Math.PI*rP*rP*course).toFixed(2);
  volTigeVol.textContent =
    (volumeMort + Math.PI*(rP*rP - rT*rT)*(maxCourse-course)).toFixed(2);

  valCourse.textContent = course.toFixed(2);
  valRot.textContent = sliderRot.value + "°";
  valPiston.textContent = diameterPiston.toFixed(1);
  valTige.textContent = diameterTige.toFixed(1);
}

/* ================== UI ================== */
sliderCourse.oninput = updateVerin;
sliderRot.oninput = updateVerin;

sliderPiston.oninput = () => {
  diameterPiston = parseFloat(sliderPiston.value);
  rebuildVerin();
};
sliderTige.oninput = () => {
  diameterTige = parseFloat(sliderTige.value);
  rebuildVerin();
};

/* ================== INIT ================== */
createVerin();
updateVerin();

/* ================== RESIZE ================== */
addEventListener("resize", () => {
  camera.aspect = innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth, innerHeight);
  labelRenderer.setSize(innerWidth, innerHeight);
});

/* ================== LOOP ================== */
function animate(){
  requestAnimationFrame(animate);
  renderer.render(scene,camera);
  labelRenderer.render(scene,camera);
}
animate();
</script>

</body>
</html>
